---
title: "R in 3 Months: Week 6<br>(Git + GitHub) HELLO!"
output:
  xaringan::moon_reader:
    css: ["style.css", "default"]
    lib_dir: libs
    df_print: paged
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE, eval = TRUE}
options(htmltools.preserve.raw = FALSE)
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)
library("tidyverse")
library("wakefield")
library(palmerpenguins)
library(janitor)
library(ggtext)
```


<!---- PLAN

THESE SLIDES USE sli.do FOR POLLS!

USE THIS LINK: https://app.sli.do/event/ndcJPnZgvf18CgCbCp93hn/live/polls

--->

```{r}

```

# Agenda

--

1. Housekeeping

--

1. Four Tips

--

1. GitHub

--

1. Next Week

---

# Housekeeping

--

- Catch-up Week

--

---

class: inverse, center, middle

# Four Tips

???

  Suggested topics:

- Do all websites give download links?
- Working with tably objects
- Beautiful tables in Rmd
- rounding

---

## Making beautiful tables in Rmd

While there's one package we recommend for charts ({ggplot2})... the package landscape is more complicated for tables.

David has written a [great blogpost comparing the most widely used packages](https://rfortherestofus.com/2019/11/how-to-make-beautiful-tables-in-r/).

--

.pull-left[

#### Interactive Tables

- [{DT}](https://rstudio.github.io/DT/) is very easy to start with and is somewhat flexible.

- [{reactablefmtr}](https://kcuilla.github.io/reactablefmtr/index.html) extends {reactable} to allow you to build beautiful and highly interactive tables.

<center><img src="images/reactablefmr-gif.gif" width='300px'/></center>

]

--

.pull-right[

#### Printable tables

- [{gt}](https://gt.rstudio.com/) is the most general purpose and flexible solution for making charts. It relies on HTML and CSS.

- [{flextable}](https://davidgohel.github.io/flextable/index.html) is the solution if you need to output to Word documents. We've also found it useful for tables that need to span multiple pages.

]

---

## Why are my columns too big?

Some folks have asked why their bar charts are too large.

```{r, include=FALSE}
bmi_data <- read_csv(here::here("data", "bars-too-long.csv"))
```

.pull-left[
```{r, eval=FALSE}
bmi_data %>% 
  ggplot(aes(x = heart_disease,
             y = avg_bmi)) +
  geom_col() +
  facet_wrap(~ sex)
```
]

.pull-right[
```{r, eval=TRUE, echo=FALSE, out.height='450px'}
bmi_data %>% 
  ggplot(aes(x = heart_disease,
             y = avg_bmi)) +
  geom_col() +
  facet_wrap(~ sex)
```
]

---


The `geom_bar()` geom does counting for us - bars length are calculated from counting how many observations there are:

.pull-left[
```{r, out.height='300px'}
msleep %>% 
  ggplot(aes(x = vore)) +
  geom_bar()
```
]

.pull-right[

```{r, out.height='300px'}
msleep %>% 
  count(vore) %>% 
  ggplot(aes(x = vore,
             y = n)) +
  geom_col()
```

]

---

## Spacing

Programming languages are very specific (or fussy) about spacing.

--

We saw a few folks had problems verifying that git was correctly installed 

<img src='images/git-without-spaces.jpg'/>

This is because git is the command and version is the tag - you **need** spaces between these two

---

## Spacing advice

1\. You **need** spaces surrounding the assignment operator in R, don't write

```{r, eval=FALSE}
data<-read_csv()
```

--

2\. Check if you've missed out spacing

--

3\. Check if the spacing you need to insert is a SPACE or a TAB

--

4\. You might also need empty lines, as we saw previously with RMarkdown

```{markdown}
---
title: "Untitled"
output: html_document
---
# Introduction
RMarkdown is great
## Details
Because you can combine code and text
```

--

5\. Files will often need an empty line at the bottom, eg .csv files and the .Renviron file.

---

# mutate() and across()

Sometimes you want to do the same thing to many columns.

This can be achieved by combining `mutate()` with `across()`.

---

## Converting many dates at once

```{r}
purchase_data <- tribble(
  ~arrival_date, ~departure_date, ~purchase_date,
  "20-01-2022", "20-03-2022", "01-01-2022",
  "17-02-2022", "19-02-2022", "03-01-2022",
  "30-03-2022", "10-04-2022", "05-02-2022"
)
purchase_data
```

---

## Converting many dates at once

```{r}
library(lubridate)
purchase_data %>% 
  mutate(across(contains("date"), ~dmy(.x)))
```

---

class: inverse, center, middle

# Data Viz Examples


---

# library(ggsignif)

.pull-left[

Mauricio Montes introduced me to the {ggsignif} package that adds the fancy column comparison line.

]

.pull-right[

```{r, eval=TRUE, echo=FALSE}
library(ggsignif)
library(ggtext)
rin3_week3 <- read_csv(here::here("data", "data-mauricio-week-4.csv"))
mst_only_means <- rin3_week3 %>% 
                  filter(cohort_type == "mst") %>% 
                  summarize(mean_pcl_baseline = mean(pcl_baseline),
                            mean_pcl_post = mean(pcl_post, na.rm = TRUE))

mst_gg <- data.frame("PCL5_Score" = c(mst_only_means$mean_pcl_baseline,
                                      mst_only_means$mean_pcl_post),
                     "Time" = c("Baseline", "Post-Treatment"))

ggplot(data = mst_gg,
       mapping = aes(x = Time,
                     y = PCL5_Score,
                     group = Time,
                     fill = Time)) +
  geom_col(show.legend = FALSE) +
  geom_signif(comparisons = list(c("Baseline", "Post-Treatment")), 
              annotations = "list(italic(p) < .001, italic(d) == 1.10)", 
              parse = TRUE, 
              y_position = 70, 
              tip_length = 0.03) +
  geom_text(aes(label = round(PCL5_Score, 1)),
            vjust = 1.5,
            color = "white") +
  scale_fill_manual(values=c("dark green", "#F4B400")) +
  scale_y_continuous(limits = c(0, 80),
                     breaks = c(0, 20, 40, 60, 80),
                     expand = expansion(mult = 0, add = c(0, 1))) +
  labs(title = "PTSD Symptom Severity in MST Cohorts",
       y = "PTSD Symptom Severity (PCL-5)",
       x = "",
       caption = "<em>N</em> = 200") +
  theme_minimal() +
  theme(panel.grid.major = element_blank(),
        plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(face = "bold"), 
        plot.caption = element_markdown())
```

]

---

# Italics in charts (I)

Mauricio also wanted to add italics to part of his chart and figured out how to use `expression()`.

> But this is a really messy and unfriendly solution

--

```{r, echo=TRUE, eval=FALSE}
penguins %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point() +
  labs(title = expression(paste("Penguins are ", italic("really cool"))))
```

```{r, out.width='300px', echo=FALSE}
penguins %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point() +
  labs(title = expression(paste("Penguins are ", italic("really cool")))) +
  theme(plot.title = element_text(size = 30))
```

---

# Italics in charts (II)

Later in the course we'll introduce {ggtext} that will allow us to use HTML in {ggplot2} chart elements.

```{r, echo=TRUE, eval=FALSE}
penguins %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point() +
  labs(title = "Penguins are <em>really cool</em>")
```

```{r, out.width='300px', echo=FALSE}
penguins %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point() +
  labs(title = "Penguins are <em>really cool</em>") +
  theme(plot.title = element_markdown(size = 30))
```

---

# Highlighting sales in a scatter plot

Norm Anderson wanted to highlight specific points

```{r}
penguins %>% 
  drop_na(flipper_length_mm, bill_length_mm) %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point(aes(color = ifelse(bill_length_mm > 40, "red", "black")))
```

---

### (POLL) How would we change the colors in the chart?

```{r, eval=FALSE}
penguins %>% 
  drop_na(flipper_length_mm, bill_length_mm) %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point(aes(color = ifelse(bill_length_mm > 40, "red", "black")))
```

.pull-left[
```{r, eval=TRUE, echo=FALSE, out.height='350px'}
penguins %>% 
  drop_na(flipper_length_mm, bill_length_mm) %>% 
  ggplot(aes(flipper_length_mm,
             bill_length_mm)) +
  geom_point(aes(color = ifelse(bill_length_mm > 40, "red", "black")))
```
]

.pull-right[
<center'><a href='https://app.sli.do/event/ndcJPnZgvf18CgCbCp93hn/live/polls'>app.sli.do/event/ndcJPnZgvf18CgCbCp93hn/live/polls</a></center>
]


---

class: inverse, center, middle

# Git + GitHub

???

- Have to save files first

---

# GitHub Desktop

The git tab in RStudio is great, it will suit most of your needs.

GitHub Desktop provides some additional tools and capabilities that might be useful for more advanced users.

--

If you can't get RStudio and git to work together then consider trying GitHub Desktop instead.

---

# Editing files in the browser on GitHub

The GitHub website gives you the ability to edit files directly.

Technically, this is exactly the same as making a commit.

Remember you will need to **pull** the changes onto your local machine.

---

class: inverse, center, middle

# Group Work

---

## Group Work

In your groups we'd like you to discuss your datasets with one another and to take a look at your charts.

- Please take it in turns to share your screen

- Share something you're struggling (or want) to do with your data. 

    - Ask if anyone else in the team needs to do something similar
    
    - Discuss potential solutions
    
    - Add your struggles (and possible solutions) [to this poll](https://app.sli.do/event/ndcJPnZgvf18CgCbCp93hn/embed/polls/4cefc4be-4c0d-42af-a6e9-ace6290f3ab1)

--

- Show a chart you've built to your group 

    - Describe something you'd like to add to your chart
    
    - Discuss potential solutions
    
    - Add your struggles (and possible solutions) [to this poll](https://app.sli.do/event/ndcJPnZgvf18CgCbCp93hn/embed/polls/2c788ef4-24df-499c-b614-7c6606d79874)
 
???

This is what we did last year:

We need to figure this out. Last time we did:

- In a group, nominate one person to create a new project, add a local Git repository, and then push it to GitHub.

- Have the nominated person share their screen and then walk through the steps as a group
  
- Add any questions that come up to [this discussion thread](https://rfortherestofus.com/groups/r-in-3-months-fall-2021/forum/discussion/general-git-github-questions/).

---

class: inverse, center, middle

## Git + GitHub Questions

???

Need to save first in order to commit

Can only commit items that have been modified since last commit


---

# Next Week
<!-- Charlie's example video was built with this gist https://gist.github.com/charliejhadley/b2bc9af0853779093f1ce7308687ef48 -->

--

1. Advanced data wrangling

--

1. The main thing to make sense of is the concept of tidy data (it's a hard concept, but worth the effort to figure it out!)

--

1. Project assignment: figure out ways your data is not tidy and tidy it (sounds simple, but it's not!).

--

1. You'll work in your GitHub repository from now on so you'll submit a link to the code in your repo for Charlie's review





